<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <title th:text="${candidate_list_title}"></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}" />
</head>

<style>
    /* T·ªïng th·ªÉ */

    .module-title {
        color: var(--primary-dark);
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    .submodule-title {
        color: var(--gray);
        font-weight: 500;
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
    }
    /* N·ªôi dung ch√≠nh */
    .content {
        margin-left: 300px;
        padding: 30px;
        font-family: 'Poppins', sans-serif;
    }

    /* ƒê·ªãnh d·∫°ng b·∫£ng */
    .table-container {
        background: white;
        border-radius: var(--card-border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        padding: 20px;
    }

    .table {
        width: 100%;
        border-collapse: separate; /* ƒê·∫£m b·∫£o kh√¥ng c√≥ vi·ªÅn vu√¥ng */
        border-spacing: 0; /* Gi·ªØ l·∫°i ƒë∆∞·ªùng k·∫ª gi·ªØa c√°c h√†ng v√† c·ªôt */
    }

    .table th {
        background-color: var(--primary);
        color: white;
        text-transform: uppercase;
        font-weight: 600;
        padding: 15px;
    }

    /* Bo tr√≤n g√≥c tr√™n */
    .table thead tr:first-child th:first-child {
        border-top-left-radius: var(--card-border-radius);
    }
    .table thead tr:first-child th:last-child {
        border-top-right-radius: var(--card-border-radius);
    }

    /* Gi·ªØ l·∫°i vi·ªÅn gi·ªØa h√†ng v√† c·ªôt */
    .table th,
    .table td {
        border: 1px solid var(--gray-light); /* ƒê·∫£m b·∫£o c√°c √¥ c√≥ ƒë∆∞·ªùng k·∫ª */
    }

    /* Hi·ªáu ·ª©ng hover */
    .table tbody tr:hover {
        background-color: #f8fbff;
        transition: all 0.3s;
    }

    /* ƒê·∫£m b·∫£o khi chuy·ªÉn trang, b·∫£ng v·∫´n gi·ªØ nguy√™n thi·∫øt k·∫ø */
    .pagination + .table-container {
        border-radius: var(--card-border-radius);
        box-shadow: var(--box-shadow);
    }

    /* Hi·ªáu ·ª©ng hover */
    .action-group a:hover,
    .action-group button:hover {
        background-color: var(--accent);
        color: white;
        box-shadow: var(--box-shadow);
    }

    /* Ph√¢n trang */
    .pagination .page-link {
        color: var(--primary);
        border-radius: var(--element-border-radius);
        margin: 0 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .pagination .page-item.active .page-link {
        background: var(--gradient-primary);
        border: none;
    }

</style>

<body>
<!-- N·ªôi dung chi ti·∫øt ·ª©ng vi√™n ·ªü ƒë√¢y -->
<div class="d-flex">
    <!-- Left sidebar -->
    <div class="sidebar" th:replace="~{component/left-sidebar::leftSidebar}"></div>

    <!-- N·ªôi dung ch√≠nh -->
    <div class="content flex-grow-1">
        <div class="main-content">
            <div class="top-sidebar">
                <div class="top-sidebar-container">
                    <div class="breadcrumb-section">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item">
                                    <a href="/dashboard">
                                        <i class="fas fa-home"></i>
                                        <span th:text="${home_page}"></span>
                                    </a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page" th:text="${candidate_list_title}">
                                </li>
                            </ol>
                        </nav>
                    </div>

                    <div class="top-sidebar-actions">
                        <!-- Notifications -->
                        <div class="dropdown">
                            <button class="btn action-btn" type="button" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge">3</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end notification-menu">
                                <li class="dropdown-header">
                                    <h6 class="mb-0">Notifications</h6>
                                    <span class="text-muted small">You have 3 unread messages</span>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item notification-item unread" href="#">
                                    <div class="notification-icon bg-primary">
                                        <i class="fas fa-calendar-check text-white"></i>
                                    </div>
                                    <div class="notification-text">
                                        <p class="mb-0">New interview scheduled</p>
                                        <span class="text-muted small">15 minutes ago</span>
                                    </div>
                                </a></li>
                                <li><a class="dropdown-item notification-item unread" href="#">
                                    <div class="notification-icon bg-success">
                                        <i class="fas fa-user-check text-white"></i>
                                    </div>
                                    <div class="notification-text">
                                        <p class="mb-0">Candidate profile updated</p>
                                        <span class="text-muted small">1 hour ago</span>
                                    </div>
                                </a></li>
                                <li><a class="dropdown-item notification-item unread" href="#">
                                    <div class="notification-icon bg-warning">
                                        <i class="fas fa-clock text-white"></i>
                                    </div>
                                    <div class="notification-text">
                                        <p class="mb-0">Interview reminder</p>
                                        <span class="text-muted small">Tomorrow, 10:00 AM</span>
                                    </div>
                                </a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item text-center small" href="#">View all notifications</a></li>
                            </ul>
                        </div>

                        <!-- Settings -->
                        <div class="dropdown">
                            <button class="btn action-btn" type="button" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                <i class="fas fa-cog"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user-cog me-2"></i>Account
                                    Settings</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-palette me-2"></i>Appearance</a>
                                </li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-bell me-2"></i>Notification
                                    Settings</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-question-circle me-2"></i>Help
                                    Center</a></li>
                            </ul>
                        </div>

                        <!-- User Profile - REDESIGNED -->
                        <div class="dropdown">
                            <div class="user-profile" data-bs-toggle="dropdown">
                                <div class="user-avatar-container">
                                    <img th:src="${session.account != null ? 'https://ui-avatars.com/api/?name=' + session.account.getFullname() + '&background=random' : 'https://ui-avatars.com/api/?name=User&background=random'}"
                                         alt="User" class="user-avatar">
                                    <span class="user-status"></span>
                                </div>
                                <div class="user-info d-none d-md-flex">
                                    <span class="user-name"
                                          th:text="${session.account != null ? session.account.getFullname() : 'User Name'}">User
                                        Name</span>
                                    <span class="user-role"
                                          th:text="${session.account != null ? session.account.getDepartmentName() : 'Department'}">Department</span>
                                </div>
                                <button class="user-dropdown-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>My Profile</a>
                                </li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-history me-2"></i>Activity
                                    Log</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i
                                        class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page Header -->
            <div class="d-flex flex-column mb-4 animate__animated animate__fadeInUp">
                <h1 class="module-title">Candidate</h1>
                <p class="submodule-title">Candidate List</p>
            </div>

            <!-- Candidate Dashboard Stats Section -->
            <div class="candidate-dashboard">
                <div class="stats-section animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                    <div class="stat-card">
                        <i class="fas fa-users stat-card-bg-icon"></i>
                        <div class="stat-card-title">Total Candidates</div>
                        <div class="stat-card-value" th:text="${totalCandidates}">50</div>
                        <div class="stat-card-info positive">
                            <i class="fas fa-arrow-up"></i> 10% from last month
                        </div>
                    </div>

                    <div class="stat-card">
                        <i class="fas fa-user-check stat-card-bg-icon"></i>
                        <div class="stat-card-title">Open Candidates</div>
                        <div class="stat-card-value" th:text="${openCandidates}">0</div>
                        <div class="stat-card-info positive">
                            <i class="fas fa-arrow-up"></i> 5% from last month
                        </div>
                    </div>

                    <div class="stat-card">
                        <i class="fas fa-user-clock stat-card-bg-icon"></i>
                        <div class="stat-card-title">Waiting for Interview Candidates</div>
                        <div class="stat-card-value" th:text="${waitingForInterviewCandidates}">0</div>
                        <div class="stat-card-info negative">
                            <i class="fas fa-arrow-down"></i> 2% from last month
                        </div>
                    </div>

                    <div class="stat-card">
                        <i class="fas fa-user-tie stat-card-bg-icon"></i>
                        <div class="stat-card-title">Passed Interview Candidates</div>
                        <div class="stat-card-value" th:text="${passedInterviewCandidates}">0%</div>
                        <div class="stat-card-info positive">
                            <i class="fas fa-arrow-up"></i> 4% from last month
                        </div>
                    </div>
                </div>
            </div>





            <div class="tab-container animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">

            <!-- Thanh t√¨m ki·∫øm + L·ªçc tr·∫°ng th√°i -->
                <div class="search-section slide-in mb-4">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="searchInput" class="form-label" th:text="${search}"></label>
                            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-search"></i>
                </span>
                                <input class="form-control" id="searchInput" type="text" th:placeholder="${search} + '...'">
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label for="statusFilter" class="form-label" th:text="${statusTitle}"></label>
                            <select class="form-select" id="statusFilter">
                                <option value="" th:text="${all_status}"></option>
                                <option th:each="status : ${T(com.ims_team4.model.utils.CandidateStatus).values()}"
                                        th:value="${#strings.replace(status, '_', ' ')}"
                                        th:text="${#strings.capitalize(#strings.replace(#strings.toLowerCase(status), '_', ' '))}">
                                </option>
                            </select>
                        </div>
                    </div>
                </div>

                <a th:href="@{/candidate/add}" class="btn btn-success"
                   th:if="${!session.get('account').getRole().name().equals('ROLE_INTERVIEWER')}">
                    <i class="fa fa-plus me-1"></i>
                    <span th:text="${add_new}"></span>
                </a>

                <div class="mb-3"></div>

                <!-- B·∫£ng danh s√°ch ·ª©ng vi√™n -->
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                    <tr style="text-align: center;">
                        <th th:text="${name_title}" style="width: 15%"></th>
                        <th th:text="${skill}" style="width: 15%"></th>
                        <th th:text="${experience_title}" style="width: 10%"></th>
                        <th th:text="${positionTitle}" style="width: 10%"></th>
                        <th th:text="${statusTitle}" style="width: 10%"></th>
                        <th class="actions-column" th:text="${action}" style="width: 40%"></th>

                    </tr>
                    </thead>
                    <tbody id="candidateTable">
                    <tr th:each="candidate : ${candidates}">
                        <td th:text="${candidate.fullName ?: 'N/A'}"></td>
                        <td>
                            <ul>
                                <li th:each="skill : ${candidate.skills ?: {}}" th:text="${skill}"></li>
                            </ul>
                        </td>

                        <td th:text="${candidate.experience ?: '0'} + ' years'"></td>
                        <td th:text="${candidate.positionName ?: 'N/A'}"></td>
                        <td th:text="${#strings.capitalize(#strings.replace(#strings.toLowerCase(candidate.status ?: 'Unknown'), '_', ' '))}"></td>

                        <td style="text-align: center;">
                            <div class="action-buttons">
                                <!-- N√∫t View -->
                                <button class="btn btn-primary btn-sm view-btn" th:text="${view_title}"></button>

                                <!-- Nh√≥m n√∫t thay th·∫ø -->
                                <div class="action-group d-none">
                                    <!-- N√∫t Chi ti·∫øt - V√†ng -->
                                    <a th:href="@{/candidate/details/{userId}(userId=${candidate.userId})}"
                                       class="btn btn-details" th:text="'‚ÑπÔ∏è ' + ${details_title}"></a>

                                    <!-- Ch·ªânh s·ª≠a -->
                                    <a th:href="@{/candidate/edit/{userId}(userId=${candidate.userId})}"
                                       class="btn btn-edit"
                                       th:if="${!session.get('account').getRole().name().equals('ROLE_INTERVIEWER')}"
                                       th:text="'‚úèÔ∏è ' + ${editBtn}"></a>

                                    <!-- Delete -->
                                    <button type="button"
                                            class="btn delete-btn btn-sm"
                                            th:attr="data-user-id=${candidate.userId}, data-delete-url=@{/candidate/delete/{userId}(userId=${candidate.userId})}"
                                            th:if="${!session.get('account').getRole().name().equals('ROLE_INTERVIEWER') && candidate.status == 'OPEN'}"
                                            th:text="'üóëÔ∏è ' + ${deleteBtn}">
                                    </button>
                                    <!-- Ban/Unban -->
                                    <button type="button"
                                            class="btn btn-sm ban-btn"
                                            th:classappend="${candidate.status == 'BANNED'} ? 'unban-btn' : 'ban-btn'"
                                            th:attr="data-user-id=${candidate.userId}, data-status=${candidate.status}, data-ban-url=@{/candidate/ban/{userId}(userId=${candidate.userId})}">
    <span th:if="${candidate.status == 'BANNED'}"
          th:text="${unban_title}"></span>
                                        <span th:unless="${candidate.status == 'BANNED'}"
                                              th:text="'üö´ ' + ${ban_title}"></span>
                                    </button>

                                    <!-- H·ªßy  -->
                                    <button class="btn btn-cancel" th:text="'‚ùå ' + ${cancelBtn}"></button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <!-- Ph√¢n trang -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <span id="pageInfo"></span>
                    <div>
                        <button id="prevPage" class="btn btn-outline-primary btn-sm"
                                th:text="${previous_title}"></button>
                        <button id="nextPage" class="btn btn-outline-primary btn-sm" th:text="${next_title}"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const rowsPerPage = 5;
    let currentPage = 1;
    const language = /*[[${lang}]]*/ {}
    const langConfig = {

        en: (currentPage, totalPages) => `Page ${currentPage} of ${totalPages}`,
        vi: (currentPage, totalPages) => `Trang ${currentPage} tr√™n ${totalPages}`,
        jp: (currentPage, totalPages) => `${currentPage}„Éö„Éº„Ç∏ÁõÆÔºàÂÖ®${totalPages}„Éö„Éº„Ç∏Ôºâ`,
    };
    console.log(language);

    function updatePagination(visibleRows = null) {
        // L·∫•y danh s√°ch h√†ng (to√†n b·ªô ho·∫∑c h√†ng ƒëang hi·ªÉn th·ªã)
        const rows = visibleRows || [...document.querySelectorAll('#candidateTable tr')];
        const totalRows = rows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage) || 1;

        // ƒê·∫£m b·∫£o currentPage n·∫±m trong gi·ªõi h·∫°n h·ª£p l·ªá
        if (currentPage > totalPages) currentPage = totalPages;
        if (currentPage < 1) currentPage = 1;

        // Hi·ªÉn th·ªã c√°c h√†ng c·ªßa trang hi·ªán t·∫°i
        rows.forEach((row, index) => {
            row.style.display = (index >= (currentPage - 1) * rowsPerPage && index < currentPage * rowsPerPage) ? '' : 'none';
        });

        // C·∫≠p nh·∫≠t th√¥ng tin ph√¢n trang
        document.getElementById('pageInfo').textContent = langConfig[language]?.(currentPage, totalPages) || langConfig['en'](currentPage, totalPages);
        // document.getElementById('pageInfo').textContent = `Trang ${currentPage} tr√™n ${totalPages}`;
        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    // S·ª± ki·ªán cho n√∫t "Prev Page"
    document.getElementById('prevPage').addEventListener('click', function () {
        if (currentPage > 1) {
            currentPage--;
            const rows = [...document.querySelectorAll('#candidateTable tr')];
            updatePagination(rows);
        }
    });

    // S·ª± ki·ªán cho n√∫t "Next Page"
    document.getElementById('nextPage').addEventListener('click', function () {
        const rows = [...document.querySelectorAll('#candidateTable tr')];
        const totalPages = Math.ceil(rows.length / rowsPerPage);
        if (currentPage < totalPages) {
            currentPage + 1;
            updatePagination(rows);
        }
    });

    // Khi trang ƒë∆∞·ª£c t·∫£i l·∫ßn ƒë·∫ßu ti√™n
    document.addEventListener("DOMContentLoaded", function () {
        const rows = [...document.querySelectorAll('#candidateTable tr')];
        currentPage = 1; // ƒê·∫£m b·∫£o trang b·∫Øt ƒë·∫ßu t·ª´ trang 1
        updatePagination(rows); // G·ªçi c·∫≠p nh·∫≠t ph√¢n trang v·ªõi to√†n b·ªô h√†ng
    });

    // S·ª± ki·ªán cho √¥ t√¨m ki·∫øm
    document.getElementById('searchInput').addEventListener('keyup', function () {
        const searchValue = this.value.toLowerCase();
        const selectedStatus = document.getElementById('statusFilter').value.toLowerCase(); // L·∫•y tr·∫°ng th√°i ƒë√£ ch·ªçn
        const rows = [...document.querySelectorAll('#candidateTable tr')]; // T·∫•t c·∫£ c√°c h√†ng trong b·∫£ng
        let visibleRows = [];

        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let matchSearch = false;
            let matchStatus = selectedStatus === "" || cells[4]?.textContent.toLowerCase() === selectedStatus;

            // Ki·ªÉm tra gi√° tr·ªã t√¨m ki·∫øm
            cells.forEach(cell => {
                if (cell.textContent.toLowerCase().includes(searchValue)) {
                    matchSearch = true;
                }
            });

            // N·∫øu h√†ng th·ªèa m√£n c·∫£ tr·∫°ng th√°i v√† t√¨m ki·∫øm, th√™m v√†o visibleRows
            if (matchSearch && matchStatus) {
                visibleRows.push(row);
                row.style.display = ''; // Hi·ªÉn th·ªã h√†ng
            } else {
                row.style.display = 'none'; // ·∫®n h√†ng kh√¥ng ph√π h·ª£p
            }
        });

        if (visibleRows.length > 0) {
            currentPage = 1; // ƒê·∫∑t l·∫°i trang ƒë·∫ßu ti√™n
            updatePagination(visibleRows); // Ph√¢n trang v·ªõi c√°c h√†ng ph√π h·ª£p
        } else {
            // N·∫øu kh√¥ng c√≥ k·∫øt qu·∫£
            document.getElementById('pageInfo').textContent = `No results found`;
            document.getElementById('prevPage').disabled = true;
            document.getElementById('nextPage').disabled = true;
        }
    });

    // üîò C·∫≠p nh·∫≠t l·∫ßn ƒë·∫ßu khi t·∫£i trang
    updatePagination([...document.querySelectorAll('#candidateTable tr')]);

    document.addEventListener("DOMContentLoaded", function () {
        // G·ªçi h√†m updatePagination ngay khi trang ƒë∆∞·ª£c t·∫£i
        const rows = [...document.querySelectorAll('#candidateTable tr')];
        updatePagination(rows);

        // G√°n s·ª± ki·ªán cho n√∫t "Prev Page"
        document.getElementById('prevPage').addEventListener('click', function () {
            // ƒê·∫£m b·∫£o currentPage kh√¥ng gi·∫£m d∆∞·ªõi 1
            if (currentPage > 1) {
                currentPage - 1; // L√πi ƒë√∫ng 1 trang
                updatePagination(rows); // C·∫≠p nh·∫≠t ph√¢n trang
            }
        });


        // G√°n s·ª± ki·ªán cho n√∫t "Next Page"
        document.getElementById('nextPage').addEventListener('click', function () {
            const totalRows = rows.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination(rows);
            }
        });

    });

    document.addEventListener("DOMContentLoaded", function () {
        const actionButtonsList = document.querySelectorAll(".action-buttons");

        actionButtonsList.forEach((actionButtons) => {
            const viewButton = actionButtons.querySelector(".view-btn");
            const actionGroup = actionButtons.querySelector(".action-group");
            const cancelButton = actionGroup.querySelector(".btn-cancel");

            // S·ª± ki·ªán khi nh·∫•n "View"
            viewButton.addEventListener("click", function () {
                viewButton.style.display = "none"; // ·∫®n n√∫t View
                actionGroup.classList.remove("d-none"); // Hi·ªÉn th·ªã nh√≥m n√∫t
            });

            // S·ª± ki·ªán khi nh·∫•n "Cancel"
            cancelButton.addEventListener("click", function () {
                actionGroup.classList.add("d-none"); // ·∫®n nh√≥m n√∫t thay th·∫ø
                viewButton.style.display = "inline-block"; // Hi·ªÉn th·ªã l·∫°i n√∫t View
            });
        });
    });

    document.getElementById('statusFilter').addEventListener('change', function () {
        const selectedStatus = this.value.toLowerCase(); // L·∫•y tr·∫°ng th√°i ƒë√£ ch·ªçn
        const searchValue = document.getElementById('searchInput').value.toLowerCase(); // L·∫•y gi√° tr·ªã t√¨m ki·∫øm
        const rows = [...document.querySelectorAll('#candidateTable tr')]; // T·∫•t c·∫£ c√°c h√†ng trong b·∫£ng
        const rowsPerPage = 5;
        let visibleRows = [];
        let currentPage = 1;

        // Khi ch·ªçn "All Status", hi·ªÉn th·ªã t·∫•t c·∫£ c√°c h√†ng nh∆∞ng v·∫´n gi·ªØ k·∫øt qu·∫£ t√¨m ki·∫øm
        if (selectedStatus === "") {
            visibleRows = rows.filter(row => {
                const cells = row.querySelectorAll('td');
                return cells.length > 0 && [...cells].some(cell => cell.textContent.toLowerCase().includes(searchValue));
            });
        } else {
            // L·ªçc c√°c h√†ng theo tr·∫°ng th√°i c·ª• th·ªÉ
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                let matchSearch = false;
                let matchStatus = cells[4]?.textContent.toLowerCase() === selectedStatus;

                // Ki·ªÉm tra gi√° tr·ªã t√¨m ki·∫øm
                cells.forEach(cell => {
                    if (cell.textContent.toLowerCase().includes(searchValue)) {
                        matchSearch = true;
                    }
                });

                // N·∫øu h√†ng th·ªèa m√£n, th√™m v√†o danh s√°ch visibleRows
                if (matchSearch && matchStatus) {
                    visibleRows.push(row);
                } else {
                    row.style.display = 'none'; // ·∫®n c√°c h√†ng kh√¥ng kh·ªõp
                }
            });
        }

        // H√†m c·∫≠p nh·∫≠t ph√¢n trang
        const updatePagination = () => {
            const totalPages = Math.ceil(visibleRows.length / rowsPerPage);
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;

            // ·∫®n t·∫•t c·∫£ h√†ng tr∆∞·ªõc khi hi·ªÉn th·ªã h√†ng thu·ªôc trang hi·ªán t·∫°i
            rows.forEach(row => row.style.display = 'none');

            // Hi·ªÉn th·ªã c√°c h√†ng c·ªßa trang hi·ªán t·∫°i
            visibleRows.slice(start, end).forEach(row => {
                row.style.display = '';
            });

            // C·∫≠p nh·∫≠t th√¥ng tin ph√¢n trang
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        };

        // G√°n s·ª± ki·ªán cho n√∫t ph√¢n trang
        document.getElementById('prevPage').onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        };

        document.getElementById('nextPage').onclick = () => {
            const totalPages = Math.ceil(visibleRows.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        };

        // C·∫≠p nh·∫≠t ph√¢n trang khi c√≥ k·∫øt qu·∫£
        if (visibleRows.length > 0) {
            updatePagination();
        } else {
            // N·∫øu kh√¥ng c√≥ h√†ng n√†o, hi·ªÉn th·ªã th√¥ng b√°o
            document.getElementById('pageInfo').textContent = `No results found`;
            document.getElementById('prevPage').disabled = true;
            document.getElementById('nextPage').disabled = true;
        }
    });

    function updatePaginationWithVisibleRows(visibleRows) {
        currentPage = 1; // Lu√¥n ƒë·∫∑t trang hi·ªán t·∫°i v·ªÅ trang ƒë·∫ßu ti√™n khi c·∫≠p nh·∫≠t c√°c h√†ng hi·ªÉn th·ªã
        const rows = visibleRows || [...document.querySelectorAll('#candidateTable tr')];
        const totalRows = rows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage) || 1;

        // G·ªçi h√†m updatePagination v·ªõi c√°c h√†ng hi·ªÉn th·ªã ch√≠nh x√°c
        updatePagination(rows);

        // C·∫≠p nh·∫≠t th√¥ng tin ph√¢n trang ch√≠nh x√°c
        document.getElementById('pageInfo').textContent = `Page ${currentPage} tr√™n ${totalPages}`;
        document.getElementById('prevPage').disabled = true; // V√¥ hi·ªáu n√∫t Prev khi ·ªü trang ƒë·∫ßu ti√™n
        document.getElementById('nextPage').disabled = currentPage >= totalPages; // V√¥ hi·ªáu n√∫t Next n·∫øu kh√¥ng c√≤n trang
    }

    document.getElementById('searchInput').addEventListener('keyup', function () {
        // ...
        if (visibleRows.length > 5) {
            updatePaginationWithVisibleRows(visibleRows);
        }
    });

    document.getElementById('statusFilter').addEventListener('change', function () {
        // ...
        if (visibleRows.length > 5) {
            updatePaginationWithVisibleRows(visibleRows);
        }
    });

    updatePagination();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".view-btn").forEach(viewButton => {
            viewButton.addEventListener("click", function () {
                const actionGroup = this.closest(".action-buttons").querySelector(".action-group");

                actionGroup.classList.add("show");  // Hi·ªÉn th·ªã nh√≥m n√∫t
                this.style.display = "none";  // ·∫®n n√∫t View
            });
        });

        document.querySelectorAll(".btn-cancel").forEach(cancelButton => {
            cancelButton.addEventListener("click", function () {
                const actionGroup = this.closest(".action-group");

                actionGroup.classList.remove("show");  // ·∫®n nh√≥m n√∫t
                actionGroup.closest(".action-buttons").querySelector(".view-btn").style.display = "inline-block";  // Hi·ªÉn th·ªã l·∫°i n√∫t View
            });
        });
    });



</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const errorMessage = "[[${error}]]";
        if (errorMessage && errorMessage.trim() !== "" && errorMessage !== "null") {
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: errorMessage,
                confirmButtonText: 'OK'
            });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const unbanMessage = localStorage.getItem("unbanSuccess");

        if (unbanMessage && unbanMessage.trim() !== "" && unbanMessage !== "null") {
            Swal.fire({
                icon: 'success',
                title: 'Candidate Unbanned!',
                text: unbanMessage,
                confirmButtonText: 'OK'
            });
            localStorage.removeItem("unbanSuccess");
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const banMessage = localStorage.getItem("banSuccess");

        if (banMessage && banMessage.trim() !== "" && banMessage !== "null") {
            Swal.fire({
                icon: 'success',
                title: 'Candidate Banned!',
                text: banMessage,
                confirmButtonText: 'OK'
            });
            localStorage.removeItem("banSuccess");
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const successMessage = "[[${success}]]";

        if (successMessage && successMessage.trim() !== "" && successMessage !== "null") {
            Swal.fire({
                icon: 'success',
                title: 'Delete Successful!',
                text: successMessage,
                confirmButtonText: 'OK'
            });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const editMessage = "[[${editSuccess}]]";
        const showInterviewModal = "[[${showInterviewModal}]]";
        const candidateUserId = "[[${candidateUserId}]]"; // l∆∞u tr·ªØ gi√° tr·ªã c·ªßa candidateUserId v√†o m·ªôt bi·∫øn JavaScript
        const candidateName = "[[${candidateName}]]"; // l∆∞u tr·ªØ gi√° tr·ªã c·ªßa candidateName v√†o m·ªôt bi·∫øn JavaScript

        if (editMessage && editMessage.trim() !== "" && editMessage !== "null") {
            Swal.fire({
                icon: 'success',
                title: 'Update Successful!',
                text: editMessage,
                confirmButtonText: 'OK'
            }).then((result) => {
                if (result.isConfirmed && showInterviewModal === "true") {
                    Swal.fire({
                        title: 'Interview Invitation Confirmation',
                        text: 'The status of ' + candidateName + ' is now waiting for interview. Would you like to send an interview invitation to this candidate?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        backdrop: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire({
                                title: 'Waiting for a moment...',
                                text: 'Please wait while we send the email...',
                                icon: 'info',
                                showConfirmButton: false,
                                allowOutsideClick: false
                            });
                            document.getElementById("sendInvitationForm").action = "/candidate/" + candidateUserId + "/send-invitation";
                            document.getElementById("sendInvitationForm").submit();
                        }
                    });
                }
            });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const createMessage = "[[${createSuccess}]]";

        if (createMessage && createMessage.trim() !== "" && createMessage !== "null") {
            Swal.fire({
                icon: 'success',
                title: 'Add new candidate successfully!',
                text: createMessage,
                confirmButtonText: 'OK'
            });
        }
    });
</script>

<!-- Modal x√°c nh·∫≠n g·ª≠i mail -->
<!-- Form g·ª≠i invitation -->
<form id="sendInvitationForm" method="post" action="/candidate/${candidateUserId}/send-invitation">
    <input type="hidden" name="candidateUserId" value="${candidateUserId}">
    <input type="hidden" name="candidateName" value="${candidateName}">
</form>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const emailMessage = "[[${emailMessage}]]";  // Nh·∫≠n th√¥ng b√°o t·ª´ Controller
        const emailStatus = "[[${emailStatus}]]";    // Nh·∫≠n tr·∫°ng th√°i (th√†nh c√¥ng/l·ªói)

        if (emailMessage && emailMessage.trim() !== "" && emailMessage !== "null") {
            Swal.fire({
                icon: emailStatus === "success" ? "success" : "error",
                title: emailStatus === "success" ? "Send email successfully!" : "L·ªói!",
                text: emailMessage,
                confirmButtonText: "OK"
            });
        }
    });
</script>
<input type="hidden" th:value="${emailMessage}" id="emailMessage">
<input type="hidden" th:value="${emailStatus}" id="emailStatus">

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const showInterviewModal = "[[${showInterviewModal}]]";
        console.log("Modal trigger flag from HTML:", showInterviewModal);
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const showInterviewModal = "[[${showInterviewModal}]]";
        if (showInterviewModal === "true") {
            var modal = new bootstrap.Modal(document.getElementById('interviewModal'));
            modal.show();
        }
    });
</script>


<script>
    // L·∫•y d·ªØ li·ªáu t·ª´ backend
    $.ajax({
        type: "GET",
        url: "/candidate/list",
        dataType: "html",
        success: function(data) {
            // T√¨m ki·∫øm c√°c ph·∫ßn t·ª≠ c·∫ßn t√≠nh to√°n
            var totalCandidates = $(data).find(".candidate-list").length;
            var openCandidates = $(data).find(".candidate-list .status-OPEN").length;
            var waitingForInterviewCandidates = $(data).find(".candidate-list .status-WAITING_FOR_INTERVIEW").length;
            var passedInterviewCandidates = $(data).find(".candidate-list .status-PASSED_INTERVIEW").length;

            // C·∫≠p nh·∫≠t gi√° tr·ªã c·ªßa c√°c ph·∫ßn t·ª≠ stat-card-value
            $("#totalCandidates").text(totalCandidates);
            $("#openCandidates").text(openCandidates);
            $("#waitingForInterviewCandidates").text(waitingForInterviewCandidates);
            $("#passedInterviewCandidates").text((passedInterviewCandidates / totalCandidates * 100).toFixed(2) + "%");
        }
    });
</script>

<!-- SweetAlert2 Delete & Ban & Create Candidate -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // X√≥a Candidate
        document.querySelectorAll(".delete-btn").forEach(button => {
            button.addEventListener("click", function () {
                const userId = this.getAttribute("data-user-id");

                if (!userId) {
                    console.error("‚ùå Error: Cannot get userId!");
                    return;
                }

                Swal.fire({
                    title: "Confirm Delete",
                    text: "Are you sure you want to delete this candidate?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Delete",
                    cancelButtonText: "Cancel",
                    backdrop: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = `/candidate/delete/${userId}`;
                    }
                });
            });
        });

        // Ban/Unban Candidate
        document.querySelectorAll(".ban-btn").forEach(button => {
            button.addEventListener("click", function () {
                let userId = this.getAttribute("data-user-id");
                let currentStatus = this.getAttribute("data-status");
                let actionText = currentStatus === "BANNED" ? "Unban" : "Ban";
                let message = currentStatus === "BANNED"
                    ? "Are you sure you want to unban this candidate?"
                    : "Are you sure you want to ban this candidate?";

                Swal.fire({
                    title: `${actionText} Confirmation`,
                    text: message,
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: actionText,
                    cancelButtonText: "Cancel",
                    backdrop: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(`/candidate/ban/${userId}`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            }
                        }).then(response => {
                            if (response.ok) {
                                // S·ª≠ d·ª•ng bi·∫øn unbanSuccess ho·∫∑c banSuccess ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
                                if (currentStatus === "BANNED") {
                                    localStorage.setItem("unbanSuccess", "Candidate has been unbanned successfully!");
                                } else {
                                    localStorage.setItem("banSuccess", "Candidate has been banned successfully!");
                                }
                                window.location.href = "/candidate/list"; // C·∫≠p nh·∫≠t l·∫°i danh s√°ch
                            } else {
                                // S·ª≠ d·ª•ng bi·∫øn success ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
                                localStorage.setItem("success", "Failed to update candidate status!");
                            }
                        }).catch(error => {
                            console.error("‚ùå Fetch error:", error);
                            // S·ª≠ d·ª•ng bi·∫øn success ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
                            localStorage.setItem("success", "Something went wrong!");
                        });
                    }
                });
            });
        });
    });
</script>

</body>
</html>

